{"version":3,"file":"index.umd.js","sources":["../src/index.ts"],"sourcesContent":["import {\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useReducer,\n  useRef,\n  Dispatch,\n  Reducer,\n  ReducerState,\n  ReducerAction,\n} from 'react';\n\nconst useIsomorphicLayoutEffect = typeof window !== 'undefined' ? useLayoutEffect : useEffect;\n\nexport type AsyncActionHandlers<\n  R extends Reducer<any, any>,\n  AsyncAction extends { type: string }\n> = {\n  [T in AsyncAction['type']]: AsyncAction extends infer A ? A extends {\n    type: T;\n  } ? (\n    dispatch: Dispatch<ReducerAction<R>>,\n    getState: () => ReducerState<R>,\n  ) => (a: A) => Promise<void> : never : never;\n};\n\nexport function useReducerAsync<\n  R extends Reducer<any, any>,\n  I,\n  AsyncAction extends { type: string },\n  ExportAction extends AsyncAction | ReducerAction<R> = AsyncAction | ReducerAction<R>\n>(\n  reducer: R,\n  initializerArg: I,\n  initializer: (arg: I) => ReducerState<R>,\n  asyncActionHandlers: AsyncActionHandlers<R, AsyncAction>,\n): [ReducerState<R>, Dispatch<ExportAction>];\n\n/**\n * useReducer with async actions\n * @example\n * import { useReducerAsync } from 'use-reducer-async';\n *\n * const asyncActionHandlers = {\n *   SLEEP: (dispatch, getState) => async (action) => {\n *     dispatch({ type: 'START_SLEEP' });\n *     await new Promise(r => setTimeout(r, action.ms));\n *     dispatch({ type: 'END_SLEEP' });\n *   },\n *   FETCH: (dispatch, getState) => async (action) => {\n *     dispatch({ type: 'START_FETCH' });\n *     try {\n *       const response = await fetch(action.url);\n *       const data = await response.json();\n *       dispatch({ type: 'FINISH_FETCH', data });\n *     } catch (error) {\n *       dispatch({ type: 'ERROR_FETCH', error });\n *     }\n *   },\n * };\n * const [state, dispatch] = useReducerAsync(reducer, initialState, asyncActionHandlers);\n */\nexport function useReducerAsync<\n  R extends Reducer<any, any>,\n  AsyncAction extends { type: string },\n  ExportAction extends AsyncAction | ReducerAction<R> = AsyncAction | ReducerAction<R>\n>(\n  reducer: R,\n  initialState: ReducerState<R>,\n  asyncActionHandlers: AsyncActionHandlers<R, AsyncAction>,\n): [ReducerState<R>, Dispatch<ExportAction>];\n\nexport function useReducerAsync<\n  R extends Reducer<any, any>,\n  I,\n  AsyncAction extends { type: string },\n  ExportAction extends AsyncAction | ReducerAction<R> = AsyncAction | ReducerAction<R>\n>(\n  reducer: R,\n  initializerArg: I | ReducerState<R>,\n  initializer: unknown,\n  asyncActionHandlers?: AsyncActionHandlers<R, AsyncAction>,\n): [ReducerState<R>, Dispatch<ExportAction>] {\n  const aaHandlers = (\n    asyncActionHandlers || initializer\n  ) as AsyncActionHandlers<R, AsyncAction>;\n  const [state, rawDispatch] = useReducer(\n    reducer,\n    initializerArg as any,\n    asyncActionHandlers && initializer as any,\n  );\n  const lastState = useRef(state);\n  useIsomorphicLayoutEffect(() => {\n    lastState.current = state;\n  }, [state]);\n  const getState = useCallback((() => lastState.current), []);\n  const dispatch = useCallback((action: AsyncAction | ReducerAction<R>) => {\n    const { type } = (action || {}) as { type?: AsyncAction['type'] };\n    const aaHandler = (\n      (type && aaHandlers[type]) || null\n    ) as (typeof action extends AsyncAction ? (\n      dispatch: Dispatch<ReducerAction<R>>,\n      getState: () => ReducerState<R>,\n    ) => (a: typeof action) => Promise<void> : null);\n    if (aaHandler) {\n      aaHandler(rawDispatch, getState)(action as AsyncAction);\n    } else {\n      rawDispatch(action as ReducerAction<R>);\n    }\n  }, [aaHandlers, getState]);\n  return [state, dispatch];\n}\n"],"names":["useIsomorphicLayoutEffect","window","useLayoutEffect","useEffect","reducer","initializerArg","initializer","asyncActionHandlers","aaHandlers","useReducer","state","rawDispatch","lastState","useRef","current","getState","useCallback","dispatch","action","type","aaHandler"],"mappings":"kOAYA,IAAMA,EAA8C,oBAAXC,OAAyBC,kBAAkBC,uCAkElFC,EACAC,EACAC,EACAC,GAEA,IAAMC,EACJD,GAAuBD,IAEIG,aAC3BL,EACAC,EACAE,GAAuBD,GAHlBI,OAAOC,OAKRC,EAAYC,SAAOH,GACzBV,EAA0B,WACxBY,EAAUE,QAAUJ,GACnB,CAACA,IACJ,IAAMK,EAAWC,cAAa,kBAAMJ,EAAUE,SAAU,IAClDG,EAAWD,cAAY,SAACE,OACpBC,GAAUD,GAAU,IAApBC,KACFC,EACHD,GAAQX,EAAWW,IAAU,KAK5BC,EACFA,EAAUT,EAAaI,EAAvBK,CAAiCF,GAEjCP,EAAYO,IAEb,CAACV,EAAYO,IAChB,MAAO,CAACL,EAAOO"}